<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Juego del Impostor DBZ</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 30px; background: #111; color: #eee; }
    h1 { color: #ffcc00; }
    #pantalla { font-size: 1.5em; margin: 20px; min-height: 2em; }
    button { padding: 15px 30px; font-size: 1.2em; border: none; border-radius: 8px; background: #ff4444; color: #fff; cursor: pointer; }
    button:disabled { background: #444; cursor: not-allowed; }
    img { max-width: 220px; display: block; margin: 20px auto; border-radius: 12px; box-shadow: 0 0 10px rgba(255,255,255,0.3); }
  </style>
</head>
<body>
  <h1>Juego: El Impostor DBZ</h1>
  <div id="pantalla">Cargando personaje...</div>
  <button id="btn" onclick="mostrarRol()" disabled>Ver mi rol</button>
  <img id="imagen" style="display:none">

  <script>
    const jugadores = 9;
    let roles = [];
    let contador = 0;
    let personaje = null;

    async function cargarPersonaje(){
      try {
        const total = 100; // cantidad aproximada de personajes en la API
        const randomId = Math.floor(Math.random() * total) + 1;
        const res = await fetch(`https://dragonball-api.com/api/characters/${randomId}`);
        personaje = await res.json();
        prepararRoles();
        document.getElementById("pantalla").innerText = "Jugador 1, toca el botón";
        document.getElementById("btn").disabled = false;
      } catch (e) {
        document.getElementById("pantalla").innerText = "Error al cargar personaje";
      }
    }

    function prepararRoles(){
      roles = Array(jugadores).fill("Personaje");
      let impostores = 0;
      while(impostores < 2){
        let i = Math.floor(Math.random() * jugadores);
        if(roles[i] === "Personaje"){
          roles[i] = "Impostor";
          impostores++;
        }
      }
    }

    function mostrarRol(){
      if(contador < jugadores){
        let rol = roles[contador];
        if(rol === "Impostor"){
          document.getElementById("pantalla").innerText =
            "Jugador " + (contador+1) + ": Eres IMPOSTOR";
          document.getElementById("imagen").style.display = "none";
        } else {
          document.getElementById("pantalla").innerText =
            "Jugador " + (contador+1) + ": " + personaje.name;
          document.getElementById("imagen").src = personaje.image;
          document.getElementById("imagen").style.display = "block";
        }

        // Oculta después de 3 segundos
        setTimeout(() => {
          document.getElementById("pantalla").innerText = 
            "Listo. Pasa el dispositivo al siguiente jugador.";
          document.getElementById("imagen").style.display = "none";
        }, 3000);

        contador++;
      } else {
        document.getElementById("pantalla").innerText = "Todos ya tienen rol";
        document.getElementById("imagen").style.display = "none";
        document.getElementById("btn").disabled = true;
      }
    }

    cargarPersonaje();
  </script>
</body>
</html>
